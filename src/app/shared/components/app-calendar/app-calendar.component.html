<div class="calendar-container">
  <div class="grid">
    <div class="col-12">
      <p-card styleClass="calendar-card fadein animation-duration-1000">
        <full-calendar [options]="calendarOptions"></full-calendar>
      </p-card>
    </div>

    <!-- Dialog: Registrar Turno -->
    <p-dialog
      [(visible)]="displayDialog"
      [modal]="true"
      [dismissableMask]="true"
      [style]="{ width: '36rem' }"
      [draggable]="false"
      [resizable]="false"
      header="Registrar Turno"
      (onHide)="closeRegisterModal()"
    >
      <p-progressBar
        [value]="getFormProgress()"
        styleClass="mb-3"
      ></p-progressBar>

      <form [formGroup]="appointmentForm" class="appointment-form">
        <div class="field">
          <label for="name">Nombre y Apellido</label>
          <input
            id="name"
            type="text"
            pInputText
            formControlName="name"
            class="w-full"
            placeholder="Ej. Lionel Messi"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label for="dni">DNI</label>
          <input
            id="dni"
            type="number"
            pInputText
            formControlName="dni"
            class="w-full"
            placeholder="Ingrese su DNI sin guiones ni puntos"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label for="date">Fecha</label>
          <p-calendar
            id="date"
            formControlName="date"
            [showIcon]="true"
            dateFormat="dd-mm-yy"
            styleClass="w-full calendar-input"
            placeholder="Seleccionar fecha"
          ></p-calendar>
        </div>

        <div class="field">
          <label for="time">Hora</label>
          <p-dropdown
            id="time"
            formControlName="time"
            placeholder="Seleccionar hora"
            [options]="timeSlots()"
            optionLabel="timeRange"
            optionValue="id"
            styleClass="w-full"
            emptyMessage="Seleccione una fecha."
          >
            <ng-template pTemplate="selectedItem" let-option>
              <div class="dropdown-item-selected w-full">
                <div class="time-with-dot">
                  <span
                    class="status-dot"
                    [ngClass]="
                      (option ? option.isAvailable : getSelectedIsAvailable())
                        ? 'status-dot--free'
                        : 'status-dot--busy'
                    "
                  ></span>
                  <span>{{ option?.timeRange || getSelectedTimeLabel() }}</span>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-option>
              <div
                class="dropdown-item w-full"
                [ngClass]="!option.isAvailable ? 'dropdown-item--disabled' : ''"
              >
                <div class="time-with-dot">
                  <span>{{ option.timeRange }}</span>
                </div>
                <span
                  class="status-badge"
                  [ngClass]="
                    option.isAvailable
                      ? 'status-badge--free'
                      : 'status-badge--busy'
                  "
                >
                  {{ option.isAvailable ? "Libre" : "Ocupado" }}
                </span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="field">
          <label for="clientEmail">Email</label>
          <input
            id="clientEmail"
            type="email"
            pInputText
            formControlName="clientEmail"
            class="w-full"
            placeholder="usuario@correo.com"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label for="clientPhoneNumber">Teléfono</label>
          <input
            id="clientPhoneNumber"
            type="tel"
            pInputText
            formControlName="clientPhoneNumber"
            class="w-full"
            placeholder="Ej. +54 9 11 1234 5678"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label for="amount">Monto</label>
          <input
            id="amount"
            type="number"
            pInputText
            class="w-full"
            placeholder="$10.000"
            [readonly]="true"
          />
        </div>

        <div class="field">
          <label for="description">Descripción</label>
          <textarea
            id="description"
            pInputTextarea
            formControlName="description"
            rows="3"
            class="w-full"
            placeholder="Ej. Detalles sobre el turno"
          ></textarea>
        </div>

        <div class="flex justify-content-end gap-2">
          <button
            pButton
            type="button"
            label="Cancelar"
            class="p-button-text"
            (click)="closeRegisterModal()"
          ></button>
          <button
            pButton
            type="submit"
            label="Guardar"
            class="minimal-button"
            (click)="onSubmit()"
            [disabled]="!appointmentForm.valid"
          ></button>
        </div>
      </form>
    </p-dialog>
  </div>
</div>
